/**
 * Prisma Schema for S.O.F.I.E. Backend
 * Database models for all 6 domains
 */

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

// ============================================
// WATER DOMAIN MODELS
// ============================================

model WaterRecyclingSystem {
  id            String   @id @default(cuid())
  regionId      String
  capacity      Float    // Liters
  current       Float    // Current level
  status        String   // operational, maintenance, offline
  efficiency    Float    // 0.0 - 1.0
  lastMaintenance DateTime
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([regionId])
}

model WaterQuality {
  id            String   @id @default(cuid())
  regionId      String
  ph            Float
  turbidity     Float    // NTU
  bacteria      String   // safe, elevated, unsafe
  calcium       Float    // mg/L
  magnesium     Float    // mg/L
  sodium        Float    // mg/L
  testedAt      DateTime
  createdAt     DateTime @default(now())

  @@index([regionId, testedAt])
}

model WaterUsage {
  id            String   @id @default(cuid())
  regionId      String
  daily         Float    // Liters
  weekly        Float
  monthly       Float
  yearly        Float
  trend         String   // stable, increasing, decreasing
  recordedAt    DateTime
  createdAt     DateTime @default(now())

  @@index([regionId, recordedAt])
}

model WaterLeak {
  id            String   @id @default(cuid())
  regionId      String
  location      String
  size          Float    // mm
  flowRate      Float    // L/min
  detected      Boolean
  severity      String   // low, medium, high
  detectedAt    DateTime
  repaired      Boolean
  repairedAt    DateTime?
  createdAt     DateTime @default(now())

  @@index([regionId, detected])
}

model IrrigationZone {
  id            String   @id @default(cuid())
  regionId      String
  name          String
  moisture      Float    // Percentage
  targetMoisture Float
  status        String   // healthy, dry, wet
  lastWatered   DateTime
  nextScheduled DateTime
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([regionId])
}

// ============================================
// ENERGY DOMAIN MODELS
// ============================================

model SolarPanel {
  id            String   @id @default(cuid())
  regionId      String
  panelId       String
  capacity      Float    // Watts
  current       Float    // Current output
  efficiency    Float    // 0.0 - 1.0
  temperature   Float    // Celsius
  tilt          Float    // Degrees
  generatedToday Float  // kWh
  lastUpdated   DateTime
  createdAt     DateTime @default(now())

  @@index([regionId])
}

model Battery {
  id            String   @id @default(cuid())
  regionId      String
  capacity      Float    // kWh
  current       Float    // Current charge
  health        Float    // 0.0 - 1.0
  cycles        Int      // Charge/discharge cycles
  chargeRate    Float    // kW
  dischargeRate Float   // kW
  temperature   Float    // Celsius
  lastUpdated   DateTime
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([regionId])
}

model GridConnection {
  id            String   @id @default(cuid())
  regionId      String
  importing     Boolean
  exporting     Boolean
  voltage       Float    // Volts
  frequency     Float    // Hz
  status        String   // connected, disconnected, fault
  exportedToday Float   // kWh
  importedToday Float   // kWh
  lastUpdated   DateTime
  createdAt     DateTime @default(now())

  @@index([regionId])
}

model EnergyLoad {
  id            String   @id @default(cuid())
  regionId      String
  deviceId      String
  powerUsage    Float    // Watts
  status        String   // on, off, standby
  priority      String   // critical, high, normal, low
  lastUpdated   DateTime
  createdAt     DateTime @default(now())

  @@index([regionId, deviceId])
}

// ============================================
// CLIMATE DOMAIN MODELS
// ============================================

model IndoorClimate {
  id            String   @id @default(cuid())
  regionId      String
  temperature   Float    // Celsius
  humidity      Float    // Percentage
  co2           Float    // ppm
  comfort       String   // optimal, acceptable, poor
  measuredAt    DateTime
  createdAt     DateTime @default(now())

  @@index([regionId, measuredAt])
}

model ClimateZone {
  id            String   @id @default(cuid())
  regionId      String
  name          String
  temperature   Float
  humidity      Float
  targetTemp    Float
  targetHumidity Float
  status        String
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([regionId])
}

model WeatherForecast {
  id            String   @id @default(cuid())
  regionId      String
  day           String
  highTemp      Float
  lowTemp       Float
  condition     String
  precipitation Float
  windSpeed     Float
  forecastedAt  DateTime
  createdAt     DateTime @default(now())

  @@index([regionId, forecastedAt])
}

model AirQuality {
  id            String   @id @default(cuid())
  regionId      String
  pm25          Float    // Particulate matter 2.5
  pm10          Float    // Particulate matter 10
  no2           Float    // Nitrogen dioxide
  o3            Float    // Ozone
  quality       String   // good, moderate, unhealthy
  aqiIndex      Float
  measuredAt    DateTime
  createdAt     DateTime @default(now())

  @@index([regionId, measuredAt])
}

// ============================================
// FOOD DOMAIN MODELS
// ============================================

model Garden {
  id            String   @id @default(cuid())
  regionId      String
  gardenId      String
  location      String
  areaSqm       Float
  type          String   // raised beds, containers, in-ground, hydroponic
  status        String   // active, dormant, preparing
  crops         String[]
  monthlyYield  Float    // kg
  productivity  Float    // Percentage
  waterUse      Float    // Liters
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([regionId])
  @@unique([regionId, gardenId])
}

model Crop {
  id            String   @id @default(cuid())
  regionId      String
  gardenId      String
  name          String
  type          String
  plantDate     DateTime
  harvestDate   DateTime?
  yield         Float?   // kg
  quality       String?  // excellent, good, fair, poor
  notes         String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([regionId, gardenId])
}

model NutritionMetric {
  id            String   @id @default(cuid())
  regionId      String
  category      String   // Vegetables, Fruits, Proteins, Carbohydrates
  daily         Float    // grams
  target        Float
  measuredAt    DateTime
  createdAt     DateTime @default(now())

  @@index([regionId, measuredAt])
}

model FoodStorage {
  id            String   @id @default(cuid())
  regionId      String
  location      String
  itemName      String
  quantity      Float
  unit          String   // kg, liters, count
  temperature   Float
  humidity      Float
  expiryDate    DateTime?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([regionId, location])
}

model FoodSafetyTest {
  id            String   @id @default(cuid())
  regionId      String
  testId        String
  testedItem    String
  bacteria      String   // safe, elevated, unsafe
  toxins        String?
  mold          String?
  result        String   // passed, warning, failed
  testedAt      DateTime
  createdAt     DateTime @default(now())

  @@index([regionId, testedAt])
}

// ============================================
// HEARTWARE DOMAIN MODELS
// ============================================

model Community {
  id            String   @id @default(cuid())
  regionId      String
  name          String
  description   String?
  members       Int
  status        String   // active, inactive, archived
  founded       DateTime
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([regionId])
  @@unique([regionId, name])
}

model CommunityMember {
  id            String   @id @default(cuid())
  regionId      String
  communityId   String
  userId        String
  role          String   // admin, moderator, member
  joinedAt      DateTime
  createdAt     DateTime @default(now())

  @@index([regionId, communityId])
}

model SharedResource {
  id            String   @id @default(cuid())
  regionId      String
  type          String   // tools, knowledge, space, skills
  name          String
  description   String?
  available     Int
  borrowable    Boolean
  owner         String
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([regionId, type])
}

// ============================================
// SYSTEM DOMAIN MODELS
// ============================================

model SystemExpansion {
  id            String   @id @default(cuid())
  regionId      String
  stage         String   // Phase 1, Phase 2, etc
  completion    Float    // Percentage
  nextPhase     DateTime?
  budget        Float
  spent         Float
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([regionId])
}

model Inventory {
  id            String   @id @default(cuid())
  regionId      String
  category      String
  itemName      String
  quantity      Int
  unit          String
  location      String
  lastRestocked DateTime?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([regionId, category])
}

model IoTDevice {
  id            String   @id @default(cuid())
  regionId      String
  deviceId      String
  type          String   // temperature, humidity, pump, etc
  name          String
  location      String
  status        String   // online, offline, error
  lastUpdate    DateTime
  battery       Float?   // Percentage for wireless devices
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([regionId, type])
  @@unique([regionId, deviceId])
}

model Plugin {
  id            String   @id @default(cuid())
  regionId      String
  name          String
  version       String
  status        String   // active, inactive, error
  enabled       Boolean
  config        Json?
  installedAt   DateTime
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([regionId])
}

// ============================================
// AUDIT & SYSTEM MODELS
// ============================================

model AuditLog {
  id            String   @id @default(cuid())
  regionId      String
  action        String
  domain        String
  details       Json
  userId        String?
  timestamp     DateTime @default(now())

  @@index([regionId, timestamp])
}

model SystemMetric {
  id            String   @id @default(cuid())
  regionId      String
  metric        String
  value         Float
  unit          String
  recordedAt    DateTime
  createdAt     DateTime @default(now())

  @@index([regionId, metric, recordedAt])
}
